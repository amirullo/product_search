# üîç –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø—Ä–æ–¥—É–∫—Ü–∏–∏ - REST API

–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–±–æ—á–∏–π –ø—Ä–∏–º–µ—Ä —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Å–∏–Ω–æ–Ω–∏–º–æ–≤, –∂–∞—Ä–≥–æ–Ω–∞ –∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–ª—è Apple M2 16GB.

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫** —á–µ—Ä–µ–∑ –ª–µ–≥–∫—É—é —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω—É—é –º–æ–¥–µ–ª—å `rubert-tiny2`
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–∏–Ω–æ–Ω–∏–º–æ–≤ –∏ –∂–∞—Ä–≥–æ–Ω–∞** (—à–ø–∞–∫–ª—è ‚Üí —à–ø–∞—Ç–ª–µ–≤–∫–∞, –∫–∞—Ñ–µ–ª—å ‚Üí –ø–ª–∏—Ç–∫–∞)
- **–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏** —Å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
- **Elasticsearch** —Å —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω—ã–º–∏ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞–º–∏
- **REST API** –Ω–∞ FastAPI —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π
- **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏** –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –ø–∞–º—è—Ç–∏
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫** (—Ç–æ—á–Ω—ã–π + —Å–∏–Ω–æ–Ω–∏–º—ã + —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π + Elasticsearch)

## üìã –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

### –û—Ç–¥–µ–ª–æ—á–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
- **–®–ø–∞—Ç–ª–µ–≤–∫–∞**: —à–ø–∞–∫–ª–µ–≤–∫–∞, –∑–∞–º–∞–∑–∫–∞, –≤—ã—Ä–∞–≤–Ω–∏–≤–∞—é—â–∞—è —Å–º–µ—Å—å, —Ñ–∏–Ω–∏—à–∫–∞
- **–û–±–æ–∏**: —à–ø–∞–ª–µ—Ä—ã, —Å—Ç–µ–Ω–æ–≤—ã–µ –ø–æ–∫—Ä—ã—Ç–∏—è, –æ–±–æ–π–∫–∞
- **–ö—Ä–∞—Å–∫–∞**: —ç–º–∞–ª—å, –ø–æ–∫—Ä—ã—Ç–∏–µ, –ª–∫–º, –≤–æ–¥–æ—ç–º—É–ª—å—Å–∏–æ–Ω–∫–∞, –∞–∫—Ä–∏–ª

### –ù–∞–ø–æ–ª—å–Ω—ã–µ –ø–æ–∫—Ä—ã—Ç–∏—è  
- **–õ–∞–º–∏–Ω–∞—Ç**: –ª–∞–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª, –¥–µ—Ä–µ–≤—è–Ω–Ω—ã–µ –ø–∞–Ω–µ–ª–∏
- **–ü–ª–∏—Ç–∫–∞**: –∫–∞—Ñ–µ–ª—å, –∫–µ—Ä–∞–º–∏–∫–∞, –∫–µ—Ä–∞–º–æ–≥—Ä–∞–Ω–∏—Ç
- **–õ–∏–Ω–æ–ª–µ—É–º**: —Ä—É–ª–æ–Ω–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ, –ø–≤—Ö –ø–æ–∫—Ä—ã—Ç–∏–µ

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
- **–®–ø–∞—Ç–µ–ª–∏**: –ª–æ–ø–∞—Ç–∫–∞, —Å–∫—Ä–µ–±–æ–∫
- **–ö–∏—Å—Ç–∏**: –∫–∏—Å—Ç–æ—á–∫–∞, –º–∞–ª—è—Ä–Ω–∞—è –∫–∏—Å—Ç—å

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞
```bash
# –°–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
mkdir semantic-search && cd semantic-search

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª—ã –∏–∑ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤:
# ‚îú‚îÄ‚îÄ main.py
# ‚îú‚îÄ‚îÄ requirements.txt  
# ‚îú‚îÄ‚îÄ docker-compose.yml
# ‚îú‚îÄ‚îÄ run.sh
# ‚îî‚îÄ‚îÄ README.md
```

### 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
chmod +x run.sh
./run.sh
```

### 3. –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
python3 -m venv venv
source venv/bin/activate

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# –ó–∞–ø—É—Å–∫ Elasticsearch –∏ Redis (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
docker-compose up -d

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
python3 main.py
```

## üåê –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API

### –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

**Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** http://localhost:8000/docs

#### 1. –ü–æ–∏—Å–∫ –ø—Ä–æ–¥—É–∫—Ü–∏–∏
```bash
POST /search
Content-Type: application/json

{
  "query": "—à–ø–∞–∫–ª–µ–≤–∫–∞",
  "threshold": 0.6,
  "limit": 10
}
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
```json
{
  "query": "—à–ø–∞–∫–ª–µ–≤–∫–∞",
  "results": [
    {
      "category": "–û—Ç–¥–µ–ª–æ—á–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã",
      "subcategory": "–®–ø–∞—Ç–ª–µ–≤–∫–∞", 
      "score": 0.9,
      "method": "synonym"
    }
  ],
  "total": 1,
  "processing_time": 0.123
}
```

#### 2. –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
```bash
GET /categories
```

#### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏  
```bash
GET /health
```

#### 4. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∏—Å–∫–∞
```bash
GET /stats
```

### –ü—Ä–∏–º–µ—Ä—ã cURL –∑–∞–ø—Ä–æ—Å–æ–≤

```bash
# –ü–æ–∏—Å–∫ –ø–æ —Å–∏–Ω–æ–Ω–∏–º—É
curl -X POST "http://localhost:8000/search" \
  -H "Content-Type: application/json" \
  -d '{"query": "—à–ø–∞–∫–ª–µ–≤–∫–∞", "threshold": 0.6}'

# –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫
curl -X POST "http://localhost:8000/search" \
  -H "Content-Type: application/json" \
  -d '{"query": "–Ω–∞–ø–æ–ª—å–Ω—ã–µ –ø–∞–Ω–µ–ª–∏", "threshold": 0.5}'

# –ü–æ–ª—É—á–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
curl "http://localhost:8000/categories"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
curl "http://localhost:8000/health"
```

### Python –∫–ª–∏–µ–Ω—Ç

```python
import requests

# –ü–æ–∏—Å–∫
response = requests.post("http://localhost:8000/search", json={
    "query": "–∫–∞—Ñ–µ–ª—å",
    "threshold": 0.6,
    "limit": 5
})

results = response.json()
for result in results["results"]:
    print(f"{result['category']} -> {result['subcategory']} ({result['score']:.2f})")
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è Apple M2

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞–º—è—Ç–∏
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–µ–≥–∫–∞—è –º–æ–¥–µ–ª—å `rubert-tiny2` (~40MB –≤–º–µ—Å—Ç–æ ~500MB)
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ `@lru_cache` 
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ Elasticsearch: 512MB
- –û—Ç–∫–ª—é—á–µ–Ω–∞ CUDA –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å M2

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞ CPU –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è ARM64
- Batch-–æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ FastAPI

## üìä –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∏—Å–∫–∞

1. **–¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ** (score = 1.0)
2. **–ü–æ–∏—Å–∫ –ø–æ —Å–∏–Ω–æ–Ω–∏–º–∞–º** (score = 0.9) 
3. **Elasticsearch** —Å –Ω–µ—á–µ—Ç–∫–∏–º –ø–æ–∏—Å–∫–æ–º (score –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω)
4. **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫** —á–µ—Ä–µ–∑ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ (configurable threshold)

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–µ–¥—É–ø–ª–∏—Ü–∏—Ä—É—é—Ç—Å—è –∏ —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏.

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤:
- **–ö–æ–Ω—Å–æ–ª—å** –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **–§–∞–π–ª** `search_logs.log` –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

–§–æ—Ä–º–∞—Ç –ª–æ–≥–∞:
```
2024-06-09 12:34:56 - __main__ - INFO - –ü–æ–∏—Å–∫: '—à–ø–∞–∫–ª–µ–≤–∫–∞' (threshold=0.6, limit=10)
2024-06-09 12:34:56 - __main__ - INFO - –ü–æ–∏—Å–∫ –∑–∞–≤–µ—Ä—à–µ–Ω –∑–∞ 0.123—Å, –Ω–∞–π–¥–µ–Ω–æ 3 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
```

## üóÉÔ∏è –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `categories_data` –≤ `main.py`:

```python
"–Ω–æ–≤–∞—è_–∫–∞—Ç–µ–≥–æ—Ä–∏—è": {
    "name": "–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è",
    "subcategories": {
        "–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è": {
            "name": "–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è",
            "synonyms": ["—Å–∏–Ω–æ–Ω–∏–º1", "—Å–∏–Ω–æ–Ω–∏–º2", "–∂–∞—Ä–≥–æ–Ω"]
        }
    }
}
```

## üê≥ Docker

```bash
# –¢–æ–ª—å–∫–æ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
docker-compose up -d

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down

# –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
docker-compose down -v
```

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- **Elasticsearch**: http://localhost:9200/_cluster/health
- **API docs**: http://localhost:8000/docs  
- **–õ–æ–≥–∏**: `tail -f search_logs.log`

## ‚ö° –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### Elasticsearch –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
curl http://localhost:9200

# –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ Docker (–≤ Docker Desktop)
# Settings ‚Üí Resources ‚Üí Memory ‚Üí 4GB+
```

### –ú–æ–¥–µ–ª—å –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è  
```bash
# –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞
rm -rf ~/.cache/huggingface/

# –†—É—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
python3 -c "from sentence_transformers import SentenceTransformer; SentenceTransformer('cointegrated/rubert-tiny2')"
```

### –û—à–∏–±–∫–∏ –ø–∞–º—è—Ç–∏ –Ω–∞ M2
```bash
# –£–º–µ–Ω—å—à–µ–Ω–∏–µ batch size
export TOKENIZERS_PARALLELISM=false
ulimit -v 4194304  # 4GB limit
```

## üìà –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π
```python
# –í main.py –∑–∞–º–µ–Ω–∏—Ç–µ –º–æ–¥–µ–ª—å:
model = SentenceTransformer('sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2')
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
```python
# –ó–∞–º–µ–Ω–∏—Ç–µ categories_data –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î
async def load_categories_from_db():
    # –í–∞—à –∫–æ–¥ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
    pass
```

### API –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
```python
from fastapi.security import APIKeyHeader

api_key_header = APIKeyHeader(name="X-API-Key")
```


## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - —Å–≤–æ–±–æ–¥–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ.

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ `search_logs.log`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ—Ä—Ç–æ–≤ 8000, 9200, 6379
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
